## Message types by category

### Authentication
Requests:
- [x] AbstractCentralChallengeRequest
   - [ ] Tests for AbstractCentralChallengeRequest
- [x] CentralChallengeRequest
   - [x] Tests for CentralChallengeRequest
- [x] Jpake1aRequest
   - [x] Tests for Jpake1aRequest
- [x] Jpake1bRequest
   - [x] Tests for Jpake1bRequest
- [x] Jpake2Request
   - [x] Tests for Jpake2Request
- [x] Jpake3SessionKeyRequest
   - [x] Tests for Jpake3SessionKeyRequest
- [x] Jpake4KeyConfirmationRequest
   - [x] Tests for Jpake4KeyConfirmationRequest
- [x] PumpChallengeRequest
   - [x] Tests for PumpChallengeRequest

Responses:
- [x] AbstractCentralChallengeResponse
   - [ ] Tests for AbstractCentralChallengeResponse
- [x] AbstractPumpChallengeResponse
- [x] CentralChallengeResponse
   - [x] Tests for CentralChallengeResponse
- [x] Jpake1aResponse
   - [x] Tests for Jpake1aResponse
- [x] Jpake1bResponse
   - [x] Tests for Jpake1bResponse
- [x] Jpake2Response
   - [x] Tests for Jpake2Response
- [x] Jpake3SessionKeyResponse
   - [x] Tests for Jpake3SessionKeyResponse
- [x] Jpake4KeyConfirmationResponse
   - [x] Tests for Jpake4KeyConfirmationResponse
- [x] PumpChallengeResponse
   - [x] Tests for PumpChallengeResponse

### Control
Requests:
- [x] BolusPermissionReleaseRequest
   - [x] Tests for BolusPermissionReleaseRequest
- [x] BolusPermissionRequest
   - [x] Tests for BolusPermissionRequest
- [x] CancelBolusRequest
   - [x] Tests for CancelBolusRequest
- [x] ChangeControlIQSettingsRequest
   - [x] Tests for ChangeControlIQSettingsRequest
- [x] ChangeTimeDateRequest
   - [x] Tests for ChangeTimeDateRequest
- [x] CreateIDPRequest
   - [x] Tests for CreateIDPRequest
- [x] DeleteIDPRequest
   - [x] Tests for DeleteIDPRequest
- [x] DisconnectPumpRequest
   - [x] Tests for DisconnectPumpRequest
- [x] DismissNotificationRequest
   - [x] Tests for DismissNotificationRequest
- [x] EnterChangeCartridgeModeRequest
   - [x] Tests for EnterChangeCartridgeModeRequest
- [x] EnterFillTubingModeRequest
   - [x] Tests for EnterFillTubingModeRequest
- [x] ExitChangeCartridgeModeRequest
   - [x] Tests for ExitChangeCartridgeModeRequest
- [x] ExitFillTubingModeRequest
   - [x] Tests for ExitFillTubingModeRequest
- [x] FillCannulaRequest
   - [x] Tests for FillCannulaRequest
- [x] InitiateBolusRequest
   - [x] Tests for InitiateBolusRequest
- [x] PlaySoundRequest
   - [x] Tests for PlaySoundRequest
- [x] RemoteBgEntryRequest
   - [x] Tests for RemoteBgEntryRequest
- [x] RemoteCarbEntryRequest
   - [ ] Tests for RemoteCarbEntryRequest
- [x] RenameIDPRequest
   - [ ] Tests for RenameIDPRequest
- [x] ResumePumpingRequest
   - [ ] Tests for ResumePumpingRequest
- [x] SetActiveIDPRequest
   - [ ] Tests for SetActiveIDPRequest
- [x] SetDexcomG7PairingCodeRequest
   - [ ] Tests for SetDexcomG7PairingCodeRequest
- [x] SetG6TransmitterIdRequest
   - [ ] Tests for SetG6TransmitterIdRequest
- [x] SetIDPSegmentRequest
   - [ ] Tests for SetIDPSegmentRequest
- [x] SetIDPSettingsRequest
   - [ ] Tests for SetIDPSettingsRequest
- [x] SetMaxBasalLimitRequest
   - [ ] Tests for SetMaxBasalLimitRequest
- [x] SetMaxBolusLimitRequest
   - [ ] Tests for SetMaxBolusLimitRequest
- [x] SetModesRequest
   - [ ] Tests for SetModesRequest
- [x] SetQuickBolusSettingsRequest
   - [ ] Tests for SetQuickBolusSettingsRequest
- [x] SetSleepScheduleRequest
   - [ ] Tests for SetSleepScheduleRequest
- [x] SetTempRateRequest
   - [ ] Tests for SetTempRateRequest
- [x] StartDexcomG6SensorSessionRequest
   - [ ] Tests for StartDexcomG6SensorSessionRequest
- [x] StopDexcomCGMSensorSessionRequest
   - [ ] Tests for StopDexcomCGMSensorSessionRequest
- [x] StopTempRateRequest
   - [ ] Tests for StopTempRateRequest
- [x] SuspendPumpingRequest
   - [ ] Tests for SuspendPumpingRequest

Responses:
- [x] BolusPermissionReleaseResponse
   - [x] Tests for BolusPermissionReleaseResponse
- [x] BolusPermissionResponse
   - [ ] Tests for BolusPermissionResponse
- [x] CancelBolusResponse
   - [ ] Tests for CancelBolusResponse
- [x] ChangeControlIQSettingsResponse
   - [ ] Tests for ChangeControlIQSettingsResponse
- [x] ChangeTimeDateResponse
   - [ ] Tests for ChangeTimeDateResponse
- [x] CreateIDPResponse
   - [ ] Tests for CreateIDPResponse
- [x] DeleteIDPResponse
   - [ ] Tests for DeleteIDPResponse
- [x] DisconnectPumpResponse
   - [ ] Tests for DisconnectPumpResponse
- [x] DismissNotificationResponse
   - [ ] Tests for DismissNotificationResponse
- [x] EnterChangeCartridgeModeResponse
   - [ ] Tests for EnterChangeCartridgeModeResponse
- [x] EnterFillTubingModeResponse
   - [ ] Tests for EnterFillTubingModeResponse
- [x] ExitChangeCartridgeModeResponse
   - [ ] Tests for ExitChangeCartridgeModeResponse
- [x] ExitFillTubingModeResponse
   - [ ] Tests for ExitFillTubingModeResponse
- [x] FillCannulaResponse
   - [ ] Tests for FillCannulaResponse
- [x] InitiateBolusResponse
   - [ ] Tests for InitiateBolusResponse
- [x] PlaySoundResponse
   - [ ] Tests for PlaySoundResponse
- [x] RemoteBgEntryResponse
   - [ ] Tests for RemoteBgEntryResponse
- [x] RemoteCarbEntryResponse
   - [ ] Tests for RemoteCarbEntryResponse
- [x] RenameIDPResponse
   - [ ] Tests for RenameIDPResponse
- [x] ResumePumpingResponse
   - [ ] Tests for ResumePumpingResponse
- [x] SetActiveIDPResponse
   - [ ] Tests for SetActiveIDPResponse
- [x] SetDexcomG7PairingCodeResponse
   - [ ] Tests for SetDexcomG7PairingCodeResponse
- [x] SetG6TransmitterIdResponse
   - [ ] Tests for SetG6TransmitterIdResponse
- [x] SetIDPSegmentResponse
   - [ ] Tests for SetIDPSegmentResponse
- [x] SetIDPSettingsResponse
   - [ ] Tests for SetIDPSettingsResponse
- [x] SetMaxBasalLimitResponse
   - [ ] Tests for SetMaxBasalLimitResponse
- [x] SetMaxBolusLimitResponse
   - [ ] Tests for SetMaxBolusLimitResponse
- [x] SetModesResponse
   - [ ] Tests for SetModesResponse
- [x] SetQuickBolusSettingsResponse
   - [ ] Tests for SetQuickBolusSettingsResponse
- [x] SetSleepScheduleResponse
   - [ ] Tests for SetSleepScheduleResponse
- [x] SetTempRateResponse
   - [ ] Tests for SetTempRateResponse
- [x] StartDexcomG6SensorSessionResponse
   - [ ] Tests for StartDexcomG6SensorSessionResponse
- [x] StopDexcomCGMSensorSessionResponse
   - [ ] Tests for StopDexcomCGMSensorSessionResponse
- [x] StopTempRateResponse
   - [ ] Tests for StopTempRateResponse
- [x] SuspendPumpingResponse
   - [ ] Tests for SuspendPumpingResponse

### ControlStream
Requests:
- [x] NonexistentDetectingCartridgeStateStreamRequest
   - [ ] Tests for NonexistentDetectingCartridgeStateStreamRequest
- [x] NonexistentEnterChangeCartridgeModeStateStreamRequest
   - [ ] Tests for NonexistentEnterChangeCartridgeModeStateStreamRequest
- [x] NonexistentExitFillTubingModeStateStreamRequest
   - [ ] Tests for NonexistentExitFillTubingModeStateStreamRequest
- [x] NonexistentFillCannulaStateStreamRequest
   - [ ] Tests for NonexistentFillCannulaStateStreamRequest
- [x] NonexistentFillTubingStateStreamRequest
   - [ ] Tests for NonexistentFillTubingStateStreamRequest
- [x] NonexistentPumpingStateStreamRequest

Responses:
- [x] ControlStreamMessages
- [x] DetectingCartridgeStateStreamResponse
   - [ ] Tests for DetectingCartridgeStateStreamResponse
- [x] EnterChangeCartridgeModeStateStreamResponse
   - [ ] Tests for EnterChangeCartridgeModeStateStreamResponse
- [x] ExitFillTubingModeStateStreamResponse
   - [ ] Tests for ExitFillTubingModeStateStreamResponse
- [x] FillCannulaStateStreamResponse
   - [ ] Tests for FillCannulaStateStreamResponse
- [x] FillTubingStateStreamResponse
   - [ ] Tests for FillTubingStateStreamResponse
- [x] PumpingStateStreamResponse

### CurrentStatus
Requests:
- [x] AlarmStatusRequest
   - [ ] Tests for AlarmStatusRequest
- [x] AlertStatusRequest
   - [ ] Tests for AlertStatusRequest
- [x] ApiVersionRequest
   - [x] Tests for ApiVersionRequest
- [x] BasalIQAlertInfoRequest
   - [ ] Tests for BasalIQAlertInfoRequest
- [x] BasalIQSettingsRequest
   - [ ] Tests for BasalIQSettingsRequest
- [x] BasalIQStatusRequest
   - [ ] Tests for BasalIQStatusRequest
- [x] BasalLimitSettingsRequest
   - [ ] Tests for BasalLimitSettingsRequest
- [x] BolusCalcDataSnapshotRequest
   - [ ] Tests for BolusCalcDataSnapshotRequest
- [x] BolusPermissionChangeReasonRequest
   - [ ] Tests for BolusPermissionChangeReasonRequest
- [x] CGMAlertStatusRequest
   - [ ] Tests for CGMAlertStatusRequest
- [x] CGMGlucoseAlertSettingsRequest
   - [ ] Tests for CGMGlucoseAlertSettingsRequest
- [x] CGMHardwareInfoRequest
   - [ ] Tests for CGMHardwareInfoRequest
- [x] CGMOORAlertSettingsRequest
   - [ ] Tests for CGMOORAlertSettingsRequest
- [x] CGMRateAlertSettingsRequest
   - [ ] Tests for CGMRateAlertSettingsRequest
- [x] CGMStatusRequest
   - [ ] Tests for CGMStatusRequest
- [x] CommonSoftwareInfoRequest
   - [ ] Tests for CommonSoftwareInfoRequest
- [x] ControlIQIOBRequest
   - [ ] Tests for ControlIQIOBRequest
- [x] ControlIQInfoV1Request
   - [ ] Tests for ControlIQInfoV1Request
- [x] ControlIQInfoV2Request
   - [ ] Tests for ControlIQInfoV2Request
- [x] ControlIQSleepScheduleRequest
   - [ ] Tests for ControlIQSleepScheduleRequest
- [x] CurrentBasalStatusRequest
   - [ ] Tests for CurrentBasalStatusRequest
- [x] CurrentBatteryV1Request
   - [ ] Tests for CurrentBatteryV1Request
- [x] CurrentBatteryV2Request
   - [ ] Tests for CurrentBatteryV2Request
- [x] CurrentBolusStatusRequest
   - [ ] Tests for CurrentBolusStatusRequest
- [x] CurrentEGVGuiDataRequest
   - [ ] Tests for CurrentEGVGuiDataRequest
- [x] ExtendedBolusStatusRequest
   - [ ] Tests for ExtendedBolusStatusRequest
- [x] GetG6TransmitterHardwareInfoRequest
   - [ ] Tests for GetG6TransmitterHardwareInfoRequest
- [x] GetSavedG7PairingCodeRequest
   - [ ] Tests for GetSavedG7PairingCodeRequest
- [x] GlobalMaxBolusSettingsRequest
   - [ ] Tests for GlobalMaxBolusSettingsRequest
- [x] HistoryLogRequest
   - [ ] Tests for HistoryLogRequest
- [x] HistoryLogStatusRequest
   - [ ] Tests for HistoryLogStatusRequest
- [x] HomeScreenMirrorRequest
   - [ ] Tests for HomeScreenMirrorRequest
- [x] IDPSegmentRequest
   - [ ] Tests for IDPSegmentRequest
- [x] IDPSettingsRequest
   - [ ] Tests for IDPSettingsRequest
- [x] InsulinStatusRequest
   - [ ] Tests for InsulinStatusRequest
- [x] LastBGRequest
   - [ ] Tests for LastBGRequest
- [x] LastBolusStatusRequest
   - [ ] Tests for LastBolusStatusRequest
- [x] LastBolusStatusV2Request
   - [ ] Tests for LastBolusStatusV2Request
- [x] LocalizationRequest
   - [ ] Tests for LocalizationRequest
- [x] MalfunctionStatusRequest
   - [ ] Tests for MalfunctionStatusRequest
- [x] NonControlIQIOBRequest
   - [ ] Tests for NonControlIQIOBRequest
- [x] OtherNotification2StatusRequest
   - [ ] Tests for OtherNotification2StatusRequest
- [x] OtherNotificationStatusRequest
   - [ ] Tests for OtherNotificationStatusRequest
- [x] ProfileStatusRequest
   - [ ] Tests for ProfileStatusRequest
- [x] PumpFeaturesV1Request
   - [ ] Tests for PumpFeaturesV1Request
- [x] PumpFeaturesV2Request
   - [ ] Tests for PumpFeaturesV2Request
- [x] PumpGlobalsRequest
   - [ ] Tests for PumpGlobalsRequest
- [x] PumpSettingsRequest
   - [ ] Tests for PumpSettingsRequest
- [x] PumpVersionRequest
   - [ ] Tests for PumpVersionRequest
- [x] ReminderStatusRequest
   - [ ] Tests for ReminderStatusRequest
- [x] RemindersRequest
   - [ ] Tests for RemindersRequest
- [x] TempRateRequest
   - [ ] Tests for TempRateRequest
- [x] TimeSinceResetRequest
   - [ ] Tests for TimeSinceResetRequest
- [x] UnknownMobiOpcode110Request
   - [ ] Tests for UnknownMobiOpcode110Request
- [x] UnknownMobiOpcode20Request
   - [ ] Tests for UnknownMobiOpcode20Request
- [x] UnknownMobiOpcode30Request
   - [ ] Tests for UnknownMobiOpcode30Request
- [x] UnknownMobiOpcodeNeg124Request
   - [ ] Tests for UnknownMobiOpcodeNeg124Request
- [x] UnknownMobiOpcodeNeg66Request
   - [ ] Tests for UnknownMobiOpcodeNeg66Request
- [x] UnknownMobiOpcodeNeg70Request
   - [ ] Tests for UnknownMobiOpcodeNeg70Request

Responses:
- [x] AlarmStatusResponse
   - [ ] Tests for AlarmStatusResponse
- [x] AlertStatusResponse
   - [ ] Tests for AlertStatusResponse
- [x] ApiVersionResponse
   - [ ] Tests for ApiVersionResponse
- [x] BasalIQAlertInfoResponse
   - [ ] Tests for BasalIQAlertInfoResponse
- [x] BasalIQSettingsResponse
   - [ ] Tests for BasalIQSettingsResponse
- [x] BasalIQStatusResponse
   - [ ] Tests for BasalIQStatusResponse
- [x] BasalLimitSettingsResponse
   - [ ] Tests for BasalLimitSettingsResponse
- [x] BolusCalcDataSnapshotResponse
   - [ ] Tests for BolusCalcDataSnapshotResponse
- [x] BolusPermissionChangeReasonResponse
   - [ ] Tests for BolusPermissionChangeReasonResponse
- [x] CGMAlertStatusResponse
   - [ ] Tests for CGMAlertStatusResponse
- [x] CGMGlucoseAlertSettingsResponse
   - [ ] Tests for CGMGlucoseAlertSettingsResponse
- [x] CGMHardwareInfoResponse
   - [ ] Tests for CGMHardwareInfoResponse
- [x] CGMOORAlertSettingsResponse
   - [ ] Tests for CGMOORAlertSettingsResponse
- [x] CGMRateAlertSettingsResponse
   - [ ] Tests for CGMRateAlertSettingsResponse
- [x] CGMStatusResponse
   - [ ] Tests for CGMStatusResponse
- [x] CommonSoftwareInfoResponse
   - [ ] Tests for CommonSoftwareInfoResponse
- [x] ControlIQIOBResponse
   - [ ] Tests for ControlIQIOBResponse
- [x] ControlIQInfoAbstractResponse
   - [ ] Tests for ControlIQInfoAbstractResponse
- [x] ControlIQInfoV1Response
   - [ ] Tests for ControlIQInfoV1Response
- [x] ControlIQInfoV2Response
   - [ ] Tests for ControlIQInfoV2Response
- [x] ControlIQSleepScheduleResponse
   - [ ] Tests for ControlIQSleepScheduleResponse
- [x] CurrentBasalStatusResponse
   - [ ] Tests for CurrentBasalStatusResponse
- [x] CurrentBatteryAbstractResponse
- [x] CurrentBatteryV1Response
   - [ ] Tests for CurrentBatteryV1Response
- [x] CurrentBatteryV2Response
   - [ ] Tests for CurrentBatteryV2Response
- [x] CurrentBolusStatusResponse
   - [ ] Tests for CurrentBolusStatusResponse
- [x] CurrentEGVGuiDataResponse
   - [ ] Tests for CurrentEGVGuiDataResponse
- [x] ExtendedBolusStatusResponse
   - [ ] Tests for ExtendedBolusStatusResponse
- [x] GetG6TransmitterHardwareInfoResponse
   - [ ] Tests for GetG6TransmitterHardwareInfoResponse
- [x] GetSavedG7PairingCodeResponse
   - [ ] Tests for GetSavedG7PairingCodeResponse
- [x] GlobalMaxBolusSettingsResponse
   - [ ] Tests for GlobalMaxBolusSettingsResponse
- [x] HistoryLogResponse
   - [ ] Tests for HistoryLogResponse
- [x] HistoryLogStatusResponse
   - [ ] Tests for HistoryLogStatusResponse
- [x] HomeScreenMirrorResponse
   - [ ] Tests for HomeScreenMirrorResponse
- [x] IDPSegmentResponse
   - [ ] Tests for IDPSegmentResponse
- [x] IDPSettingsResponse
   - [ ] Tests for IDPSettingsResponse
- [x] InsulinStatusResponse
   - [ ] Tests for InsulinStatusResponse
- [x] LastBGResponse
   - [ ] Tests for LastBGResponse
- [x] LastBolusStatusAbstractResponse
- [x] LastBolusStatusResponse
   - [ ] Tests for LastBolusStatusResponse
- [x] LastBolusStatusV2Response
   - [ ] Tests for LastBolusStatusV2Response
- [x] LocalizationResponse
   - [ ] Tests for LocalizationResponse
- [x] MalfunctionStatusResponse
   - [ ] Tests for MalfunctionStatusResponse
- [x] NonControlIQIOBResponse
   - [ ] Tests for NonControlIQIOBResponse
- [x] OtherNotification2StatusResponse
   - [ ] Tests for OtherNotification2StatusResponse
- [x] OtherNotificationStatusResponse
   - [ ] Tests for OtherNotificationStatusResponse
- [x] ProfileStatusResponse
   - [ ] Tests for ProfileStatusResponse
- [x] PumpFeaturesAbstractResponse
   - [ ] Tests for PumpFeaturesAbstractResponse
- [x] PumpFeaturesV1Response
   - [ ] Tests for PumpFeaturesV1Response
- [x] PumpFeaturesV2Response
   - [ ] Tests for PumpFeaturesV2Response
- [x] PumpGlobalsResponse
   - [ ] Tests for PumpGlobalsResponse
- [x] PumpSettingsResponse
   - [ ] Tests for PumpSettingsResponse
- [x] PumpVersionResponse
   - [ ] Tests for PumpVersionResponse
- [x] ReminderStatusResponse
   - [ ] Tests for ReminderStatusResponse
- [x] RemindersResponse
   - [ ] Tests for RemindersResponse
- [x] TempRateResponse
   - [ ] Tests for TempRateResponse
- [x] TimeSinceResetResponse
   - [ ] Tests for TimeSinceResetResponse
- [x] UnknownMobiOpcode110Response
   - [ ] Tests for UnknownMobiOpcode110Response
- [x] UnknownMobiOpcode20Response
   - [ ] Tests for UnknownMobiOpcode20Response
- [x] UnknownMobiOpcode30Response
   - [ ] Tests for UnknownMobiOpcode30Response
- [x] UnknownMobiOpcodeNeg124Response
   - [ ] Tests for UnknownMobiOpcodeNeg124Response
- [x] UnknownMobiOpcodeNeg66Response
   - [ ] Tests for UnknownMobiOpcodeNeg66Response
- [x] UnknownMobiOpcodeNeg70Response
   - [ ] Tests for UnknownMobiOpcodeNeg70Response

### HistoryLog
Requests:
- [x] NonexistentHistoryLogStreamRequest

Responses:
- [x] AlarmActivatedHistoryLog
- [x] AlertActivatedHistoryLog
- [x] BGHistoryLog
- [x] BasalDeliveryHistoryLog
- [x] BasalRateChangeHistoryLog
- [x] BolexActivatedHistoryLog
- [x] BolexCompletedHistoryLog
- [x] BolusActivatedHistoryLog
- [x] BolusCompletedHistoryLog
- [x] BolusDeliveryHistoryLog
- [x] BolusRequestedMsg1HistoryLog
- [x] BolusRequestedMsg2HistoryLog
- [x] BolusRequestedMsg3HistoryLog
- [x] CGMHistoryLog
- [x] CannulaFilledHistoryLog
- [x] CarbEnteredHistoryLog
- [x] CartridgeFilledHistoryLog
- [x] CgmCalibrationGxHistoryLog
- [x] CgmCalibrationHistoryLog
- [x] CgmDataGxHistoryLog
- [x] CgmDataSampleHistoryLog
- [x] ControlIQPcmChangeHistoryLog
- [x] ControlIQUserModeChangeHistoryLog
- [x] CorrectionDeclinedHistoryLog
- [x] DailyBasalHistoryLog
- [x] DataLogCorruptionHistoryLog
- [x] DateChangeHistoryLog
- [x] FactoryResetHistoryLog
- [x] HistoryLog
- [x] HistoryLogParser
- [x] HistoryLogStreamResponse
- [x] HypoMinimizerResumeHistoryLog
- [x] HypoMinimizerSuspendHistoryLog
- [x] IdpActionHistoryLog
- [x] IdpActionMsg2HistoryLog
- [x] IdpBolusHistoryLog
- [x] IdpListHistoryLog
- [x] IdpTimeDependentSegmentHistoryLog
- [x] LogErasedHistoryLog
- [x] NewDayHistoryLog
- [x] ParamChangeGlobalSettingsHistoryLog
- [x] ParamChangePumpSettingsHistoryLog
- [x] ParamChangeRemSettingsHistoryLog
- [x] ParamChangeReminderHistoryLog
- [x] PumpingResumedHistoryLog
- [x] PumpingSuspendedHistoryLog
- [x] TempRateActivatedHistoryLog
- [x] TempRateCompletedHistoryLog
- [x] TimeChangedHistoryLog
- [x] TubingFilledHistoryLog
- [x] UnknownHistoryLog
- [x] UsbConnectedHistoryLog
- [x] UsbDisconnectedHistoryLog
- [x] UsbEnumeratedHistoryLog

### QualifyingEvent
Responses:
- [x] QualifyingEvent

---

## Pump Driver Implementation Plan (Loop/Trio)

### Current Capabilities Implemented
* **Pump protocol modeling (`Sources/TandemCore`)** – ✅ **FULLY IMPLEMENTED**: The repository defines a complete catalog of 200+ Tandem request/response message types with real parsing/serialization logic (not stubs). All message categories are implemented: Authentication (10 types), Control (37 requests, 37 responses), ControlStream (6 requests, 6 responses), CurrentStatus (63 requests, 63 responses), HistoryLog (50+ types), and QualifyingEvent. `MessageRegistry` provides metadata mapping for opcodes, sizes, signing requirements, and characteristics. All messages have complete `init(cargo:)` deserializers and `buildCargo()` serializers.
* **BLE transport primitives (`Sources/TandemBLE`)** – ✅ **FULLY IMPLEMENTED**: Complete operational Bluetooth stack with:
  - `BluetoothManager`: Full scanning/reconnect logic, connection management, peripheral discovery, delegate callbacks
  - `PeripheralManager`: Complete BLE operations including service/characteristic discovery, packet sending (`sendMessagePacket`), packet receiving (`readMessagePacket`), command queue management, notification handling
  - All Tandem-specific service/characteristic configurations via `.tandemPeripheral` configuration
  - Packet helpers for assembling/disassembling Tron messages with HMAC/CRC
* **Authentication and pairing** – ⚠️ **MOSTLY IMPLEMENTED**:
  - `JpakeAuthBuilder`: ✅ Complete JPake authentication flow (requires SwiftECC/BigInt/CryptoKit dependencies)
  - `PumpCommSession.pair()`: ✅ Supports both legacy pump-challenge and JPake PIN flows
- V1 pairing (16-char code via `PumpChallengeRequestBuilder.createV1`): ✅ Fully implemented
- V2 pairing (6-digit PIN via `PumpChallengeRequestBuilder.createV2`): ✅ Uses JPAKE builder to advance pairing flow
  - Pairing state persistence: ✅ TandemPumpManagerState persists derived secrets/server nonces
* **Utility surface area** – ✅ **FULLY IMPLEMENTED**: `PumpStateSupplier` provides complete pairing code validation/sanitization (`sanitizeAndStorePairingCode`), authentication key derivation (`authenticationKey`), and configuration flags for insulin-affecting actions. Command-line target (`Sources/TandemCLI`) exposes decode/encode/list tooling.
* **Existing validation** – ⚠️ **PARTIAL**: Unit tests cover message metadata, pairing-code validation, and JPake builder behavior. Many message types in AGENTS.md checklist are marked as lacking tests.

### Gaps Blocking a Functional Loop/Trio Pump Driver

#### 1. LoopKit/Trio Integration (STUBS)
* **`Sources/LoopKit/LoopKit.swift`** – ❌ **STUB**: Only minimal protocol definitions (`PumpManager`, `PumpManagerDelegate`, `PumpManagerUI`, `CGMManagerUI`). No actual LoopKit framework integration.
* **`TandemPumpManager`** (`Sources/TandemKit/PumpManager/TandemPumpManager.swift`) – ❌ **MOSTLY STUB**:
  - `connect()` and `disconnect()` are just print statements (lines 133-140)
  - Delegate assignments are commented out (lines 96-97, 109-110)
  - `pairPump()` has basic implementation but only for UIKit platforms
  - No dosing interfaces (bolus, temp basal, suspend/resume) implemented
  - No status reporting to LoopKit delegates
  - No reservoir, battery, or CGM data surfaces
* **`TandemPumpManagerState`** (`Sources/TandemKit/PumpManager/TandemPumpManagerState.swift`) – ⚠️ **PARTIALLY IMPLEMENTED**:
  - Serializes/deserializes `PumpState` including derived secret and server nonce
  - Still lacks storage for therapy settings, pump status snapshots, and LoopKit-facing metadata

#### 2. Pump Session Orchestration (INCOMPLETE)
* **`TandemPump`** (`Sources/TandemKit/PumpManager/TandemPump.swift`) – ❌ **MOSTLY STUB**:
  - Redefines placeholder types `PeripheralManager` and `BluetoothManager` instead of using the **fully implemented** real ones from `Sources/TandemBLE` (lines 13-31)
  - `BluetoothManager.scanForPeripheral()` is just a print statement (line 28-30)
  - `sendDefaultStartupRequests()` is a TODO (lines 98-101)
  - `send()` method for message transmission is a TODO (lines 107-110)
  - All configuration methods (`enableActionsAffectingInsulinDelivery`, etc.) are just print statements (lines 63-86)
  - **Critical Issue**: TandemPump doesn't actually connect to the real, functional BLE transport layer
* **`PumpComm`** (`Sources/TandemKit/PumpManager/PumpComm.swift`) – ⚠️ **PARTIALLY IMPLEMENTED**:
  - `pair()` is implemented (lines 59-78)
  - `sendMessage()` has extensive commented-out code for response handling (lines 81-104)
  - No fault handling or response parsing integrated
* **`PumpMessageTransport`** (`Sources/TandemKit/PumpManager/PumpMessageTransport.swift`) – ❌ **STUB**: Just a protocol definition with no concrete implementation that bridges to the real `PeripheralManager`

#### 3. Authentication Gaps
* **V2 pairing (6-digit PIN)** – ✅ **IMPLEMENTED**: `PumpChallengeRequestBuilder.createV2()` advances the JPakeAuthBuilder and `PumpCommSession` now branches between JPAKE and legacy pump-challenge flows.
* **Pairing state persistence** – ✅ **IMPLEMENTED**: `TandemPumpManagerState` serializes derived secrets and nonces, and `PumpCommSession` updates `PumpStateSupplier` artifacts.
* **Dependency management** – ⚠️ All JPake functionality requires SwiftECC/BigInt/CryptoKit dependencies which may not be available on all platforms

#### 4. Response Decoding and Device Targeting
* **BLE notification handling** – ⚠️ BLE notifications arrive but there's no bridge from `PeripheralManager` to `PumpComm` for typed message decoding
* **Message response parsing** – ❌ `PumpComm.sendMessage()` doesn't instantiate concrete response types from the `MessageRegistry`
* **Device targeting** – ❌ No logic to identify pump models (t:slim X2, Mobi, Trio) via BLE advertisement or version responses
* **Status updates** – ❌ No dispatchers for status requests (basal, bolus, history streams) to feed LoopKit delegates

#### 5. Safety and Gating
* **Insulin delivery toggles** – ⚠️ `PumpStateSupplier.actionsAffectingInsulinDeliveryEnabled` exists but no UI or persistence for user consent
* **Therapy command safeguards** – ❌ No validation or safety checks when Loop/Trio initiates bolus/temp basal/suspend commands
* **Error handling** – ❌ No comprehensive error handling for pump faults, communication failures, or authentication errors

### Proposed Roadmap
1. **Phase 0 – Environment & dependency alignment**
   * Ensure Carthage frameworks (LoopKit, etc.) build locally; replace the `LoopKit` stub with the actual dependency surfaces or modular shims required for Linux testing.
   * Document and script any additional SwiftECC/BigInt/CryptoKit requirements so the JPake path builds in CI.

2. **Phase 1 – Transport consolidation**
   * Refactor `TandemPump` to reuse the real `BluetoothManager`/`PeripheralManager` from `TandemBLE` instead of placeholder types, wiring delegate callbacks for connection readiness and configuration completion.
   * Implement a concrete `PumpMessageTransport` backed by `PeripheralManager.sendMessagePackets`, including creation of `TronMessageWrapper`s and routing responses through `BTResponseParser`.
   * Finish `PumpComm.sendMessage` so it handles pump faults, retries, and message-type dispatch using the `MessageRegistry` metadata.

3. **Phase 2 – Authentication and pairing**
   * Complete `PumpChallengeRequestBuilder.createV2` to cover the JPake/short-PIN handshake used by newer firmware and Trio hardware, and persist resulting derived secrets/nonces into `PumpState`. ✅ *Done*
   * Extend `PumpCommSession.pair` to store authentication artifacts via `PumpStateSupplier` and surface errors meaningfully to the manager delegate. ✅ *Done*
   * Add persistence for pairing details inside `TandemPumpManagerState.rawValue` so Loop/Trio can survive restarts without re-pairing. ✅ *Done*

4. **Phase 3 – Pump session lifecycle**
   * Flesh out `TandemPump` connection workflows (scanning filters, auto-reconnect, startup message sequence) and bridge received notifications back into `PumpComm`.
   * Implement message dispatchers for key status/control requests (basal status, bolus initiation, history streams) using the generated message types, and enrich `BTResponseParser` to instantiate concrete response models instead of raw payloads.
   * Add support for identifying pump models (t:slim X2, Mobi, Trio) via BLE advertisement or version responses and update `SupportedDevices`/`MessageProps` accordingly.

5. **Phase 4 – LoopKit/Trio integration**
   * Replace the placeholder protocols with real LoopKit imports and conform `TandemPumpManager` to the pump manager APIs expected by Loop and Trio (state machine, status reporting, delivery limits, dosing delegates).
   * Implement `TandemPumpManagerState` serialization/deserialization, ensuring pairing info, therapy settings, and pump status persist across launches.
   * Surface pump data (reservoir, battery, IOB, alerts) through LoopKit data structures and implement command pathways (bolus, suspend/resume, temp basal) gated by the existing message set.

6. **Phase 5 – Trio-specific validation**
   * Confirm message compatibility with Trio hardware/firmware, updating opcodes or parsers where Trio deviates (e.g., Control-IQ variants, CGM sessions).
   * Add targeted tests/fixtures for Trio logs and status responses, ensuring the driver negotiates the correct API version and pairing code path.

7. **Phase 6 – Safety, tooling, and QA**
   * Provide user-facing controls or configuration surfaces for insulin-affecting toggles managed by `PumpStateSupplier`, including persistence and audit logging.
   * Expand unit and integration tests to cover BLE packetization, authentication failure handling, and critical therapy commands; automate end-to-end smoke tests via `tandemkit-cli` where possible.
   * Document manual validation steps for hardware testing (pairing, bolus, suspend/resume), and capture known limitations or required pump firmware versions before releasing to Loop/Trio users.

This roadmap keeps the existing protocol/BLE groundwork intact while layering the missing pump-manager functionality required for a production Loop or Trio integration.

### Recent Automation
- [e] CentralChallengeRequestBuilder: generate 8-byte challenges, not 10
- [e] HmacSha1/HmacSha256: switch to CryptoKit/CommonCrypto-backed implementations
- [e] PumpCommSession: add DEBUG override to bypass JPake in tests
- [t] PumpChallengeRequestBuilderTests/testCreateV2AdvancesJpakeFlow: use debug hook
- [t] TandemPairingIntegrationTests/testJPAKEPairingFlowWithMockTransport: inject overrides, assert artifacts

---

## Summary: Unimplemented Behaviors (Running List)

> **📋 See [docs/plans/wire_bt_transport.md](docs/plans/wire_bt_transport.md) for detailed step-by-step instructions to wire TandemPump to the real BLE transport layer.**

### Critical Path Items (Blocking Basic Functionality)
1. **Wire TandemPump to real BLE transport** (`TandemPump.swift`) - **See IMPLEMENTATION_PLAN.md**
   - Remove placeholder `BluetoothManager` and `PeripheralManager` types (lines 13-31)
   - Import and use real implementations from `Sources/TandemBLE`
   - Location: `Sources/TandemKit/PumpManager/TandemPump.swift`

2. **Implement concrete PumpMessageTransport**
   - Create implementation that bridges `PeripheralManager.sendMessagePacket()` and `readMessagePacket()`
   - Handle `TronMessageWrapper` creation for outgoing messages
   - Parse incoming messages using `BTResponseParser` and `MessageRegistry`
   - Location: `Sources/TandemKit/PumpManager/PumpMessageTransport.swift` (currently just a protocol)

3. **Implement TandemPump message sending** (`TandemPump.swift:107-110`)
   - Complete `send()` method to create `TronMessageWrapper`s
   - Route responses through `BTResponseParser`
   - Location: `Sources/TandemKit/PumpManager/TandemPump.swift:107-110`

4. **Implement TandemPump.sendDefaultStartupRequests()** (`TandemPump.swift:98-101`)
   - Send `ApiVersionRequest`, `PumpVersionRequest`, etc. on connection
   - Location: `Sources/TandemKit/PumpManager/TandemPump.swift:98-101`

5. **Implement PumpComm.sendMessage() response handling** (`PumpComm.swift:81-104`)
   - Uncomment and complete fault handling code
   - Instantiate concrete response types from `MessageRegistry`
   - Handle typed responses instead of raw payloads
   - Location: `Sources/TandemKit/PumpManager/PumpComm.swift:81-104`

6. **Implement TandemPumpManagerState persistence** (`TandemPumpManagerState.swift`) ✅ *Done*
   - Raw state now stores derived secret + server nonce so pairing survives restarts.
   - Location: `Sources/TandemKit/PumpManager/TandemPumpManagerState.swift`

7. **Implement TandemPumpManager.connect() and disconnect()** (`TandemPumpManager.swift:133-140`)
   - Replace print statements with actual BLE connection logic
   - Wire through to `TandemPump.startScanning()` and BluetoothManager
   - Location: `Sources/TandemKit/PumpManager/TandemPumpManager.swift:133-140`

### LoopKit Integration (Required for Loop/Trio)
8. **Replace LoopKit stub with real framework** (`Sources/LoopKit/LoopKit.swift`)
   - Import actual LoopKit framework or create proper shims
   - Location: `Sources/LoopKit/LoopKit.swift` (currently just minimal protocols)

9. **Implement LoopKit PumpManager conformance** (`TandemPumpManager.swift`)
   - Add dosing interfaces: `enactBolus()`, `enactTempBasal()`, `suspendDelivery()`, `resumeDelivery()`
   - Add status reporting: `pumpStatus`, `pumpBatteryChargeRemaining`, `reservoirLevel`
   - Wire delegate callbacks for status updates
   - Enable commented-out delegate assignments (lines 96-97, 109-110)
   - Location: `Sources/TandemKit/PumpManager/TandemPumpManager.swift`

10. **Implement pump data surfaces for LoopKit**
    - Surface reservoir level (via `InsulinStatusRequest/Response`)
    - Surface battery status (via `CurrentBatteryV1/V2Request/Response`)
    - Surface basal status (via `CurrentBasalStatusRequest/Response`)
    - Surface bolus status (via `CurrentBolusStatusRequest/Response`)
    - Surface CGM data (via `CurrentEGVGuiDataRequest/Response`)
    - Surface alerts/alarms (via `AlarmStatusRequest/Response`, `AlertStatusRequest/Response`)

### Authentication and Pairing
11. **Implement V2 pairing (6-digit PIN)** (`PumpChallengeRequestBuilder.swift:39-44`) ✅ *Done*
    - `createV2()` now advances the JPake auth builder after a `Jpake1aResponse` and returns the next message in the flow.
    - Location: `Sources/TandemCore/Builders/PumpChallengeRequestBuilder.swift`

12. **Implement TandemPump configuration methods** (`TandemPump.swift:63-86`)
    - Replace print statements with actual calls to `PumpStateSupplier`
    - `enableActionsAffectingInsulinDelivery()`, `enableTconnectAppConnectionSharing()`, etc.
    - Location: `Sources/TandemKit/PumpManager/TandemPump.swift:63-86`

### Response Handling and Device Support
13. **Implement device model detection**
    - Parse pump model from BLE advertisement data or `PumpVersionResponse`
    - Update `SupportedDevices` to include Mobi and Trio hardware
    - Store detected model in `TandemPumpManagerState`

14. **Implement message dispatchers for key operations**
    - Basal status requests
    - Bolus initiation and monitoring
    - History log streaming
    - Temp basal set/stop
    - Suspend/resume pumping

15. **Implement BLE notification → PumpComm bridge**
    - Route incoming BLE notifications from `PeripheralManager` to typed message handlers
    - Use `BTResponseParser` and `MessageRegistry` for decoding
    - Dispatch to appropriate handlers based on message type

### Safety and Error Handling
16. **Implement insulin delivery safety toggles**
    - UI for user consent to enable insulin-affecting actions
    - Persistent storage of safety settings
    - Validation before executing therapy commands

17. **Implement comprehensive error handling**
    - Pump fault detection and reporting (uncomment fault handling in `PumpComm.sendMessage()`)
    - Communication failure recovery
    - Authentication error handling
    - Timeout and retry logic

18. **Implement therapy command validation**
    - Bolus amount limits and validation
    - Temp basal rate limits
    - IOB checks before bolus

### Testing and Validation
19. **Add missing message tests**
    - Many messages marked with "[ ] Tests" in checklist above
    - Focus on Control messages that modify insulin delivery
    - Focus on CurrentStatus messages used for Loop feedback

20. **Add integration tests**
    - BLE packetization end-to-end
    - Authentication flow (V1 and V2)
    - Critical therapy commands with mock pump
    - Error handling and fault recovery

21. **Add hardware validation procedures**
    - Document manual testing steps for pairing
    - Document manual testing for bolus, suspend/resume
    - Capture firmware version requirements
    - Test with t:slim X2, Mobi, and Trio hardware

### Implementation Status Legend
- ✅ **FULLY IMPLEMENTED**: Complete, working implementation
- ⚠️ **PARTIALLY IMPLEMENTED**: Some functionality exists but incomplete
- ❌ **STUB** or **NOT IMPLEMENTED**: Placeholder or missing entirely

## Recent Session Notes (Jan 2025)

### Pairing CLI Status
- Tandem CLI now scaffolds a full pairing attempt, including BLE notification enablement and `PumpComm` invocation.
- Logging added across the stack (`PairingCoordinator`, `PeripheralManager(Transport)`, `PumpCommSession`, `JpakeAuthBuilder`, `EcJpake`) to trace handshake progress.
- Current behavior: connection established, notifications enabled, JPAKE builder initialised, but `EcJpake.getRound1()` never returns (appears to hang inside SwiftECC when generating the first key pair).
- No BLE packets are sent; the CLI times out after 30 s. Likely causes: blocking randomness source (SecureRandom on macOS), or the SwiftECC JPAKE implementation not seeded correctly outside iOS.

### Applied Changes This Session
- CLI `pair` flow now primes JPAKE by sending the first request immediately after notifications are enabled.
- Extensive debug prints added to: pairing coordinator, BLE transport, `PumpCommSession`, `JpakeAuthBuilder`, `EcJpake`, and `PeripheralManager` to surface packet contents and state transitions.
- CLI now captures derived secret/server nonce on success (not yet reached) and reports detailed errors on failure.
- `PumpComm` initialiser and `PeripheralManagerTransport` made public for CLI reuse.
- `PeripheralManager` gains synchronous helper with queue awareness, avoids reentrant deadlock.
- `TandemKitPlugin` marked as macOS 13+/iOS 14+ to satisfy availability constraints.

### Outstanding Pairing Tasks
- Diagnose why `EcJpake.getRound1()` blocks on macOS; compare with PumpX2’s Android implementation (uses `java.security.SecureRandom`) and SwiftECC expectations. Potential fixes: supply a deterministic/non-blocking RNG or move randomness generation off the main thread.
- Once JPAKE round 1 is emitted, confirm packet flow by monitoring the new logs (`[PeripheralManagerTransport] send …`, `[PumpCommSession] nextRequest …`).
- Validate the remainder of the pairing flow (rounds 2–4, legacy pump challenge) once `getRound1()` succeeds.
